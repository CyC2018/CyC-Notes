```markdown
# 计算机网络 - 应用层

<!-- GFM-TOC -->
* [计算机网络 - 应用层](#计算机网络---应用层)
    * [域名系统](#域名系统)
    * [文件传送协议](#文件传送协议)
    * [动态主机配置协议](#动态主机配置协议)
    * [远程登录协议](#远程登录协议)
    * [电子邮件协议](#电子邮件协议)
        * [1. SMTP](#1-smtp)
        * [2. POP3](#2-pop3)
        * [3. IMAP](#3-imap)
    * [常用端口](#常用端口)
    * [Web 页面请求过程](#web-页面请求过程)
        * [1. DHCP 配置主机信息](#1-dhcp-配置主机信息)
        * [2. ARP 解析 MAC 地址](#2-arp-解析-mac-地址)
        * [3. DNS 解析域名](#3-dns-解析域名)
        * [4. HTTP 请求页面](#4-http-请求页面)
<!-- GFM-TOC -->


## 域名系统

域名系统（DNS，Domain Name System）是一个分布式数据库，主要用于提供主机名与 IP 地址之间的映射服务。每个 DNS 服务器只负责存储自己域名下的记录，形成了一个层次结构的数据库。

域名的组成结构：

- **根域名**（Root Domain）
- **顶级域名**（Top-Level Domain，如 .com, .org, .cn）
- **二级域名**（Second-Level Domain，如 example.com）

<div align="center"> 
    <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/b54eeb16-0b0e-484c-be62-306f57c40d77.jpg"/>
</div><br>

DNS 使用 UDP 或 TCP 进行传输，端口号均为 53。大部分情况下，DNS 采用 UDP，但在以下情况则切换到 TCP：

- 如果响应超过 512 字节（UDP 的最大负载）。
- 进行区域传送，即主 DNS 服务器与辅助 DNS 服务器之间的数据同步。

## 文件传送协议

文件传送协议（FTP，File Transfer Protocol）是用于在网络上进行文件传输的标准协议。FTP 通过 TCP 进行连接，主要使用两个连接通道：

1. **控制连接**：默认使用 21 端口。服务器在此端口上监听客户端的连接请求，并接收客户端命令。
2. **数据连接**：用于传输实际的文件数据。

FTP 有两种模式：

- **主动模式**：服务器主动建立数据连接，使用 20 端口。在这种模式下，客户端的端口号是随机选择的，但必须大于 1024（因为 0-1023 是保留给系统的重要端口）。

<div align="center"> 
    <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/03f47940-3843-4b51-9e42-5dcaff44858b.jpg"/>
</div><br>

- **被动模式**：客户端主动建立数据连接，客户端选择端口。网络安全性较高，因为只需服务器开放端口。

<div align="center"> 
    <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/be5c2c61-86d2-4dba-a289-b48ea23219de.jpg"/>
</div><br>

主动模式需要客户端开放端口，配置防火墙；而被动模式则减轻了客户端的负担，但可能降低了服务端的安全性。

## 动态主机配置协议

动态主机配置协议（DHCP，Dynamic Host Configuration Protocol）用于自动分配 IP 地址和相关网络配置。DHCP 使得设备连接网络时无需手动配置。

DHCP 提供的信息包括：

- IP 地址
- 子网掩码
- 默认网关
- DNS 服务器的 IP 地址

DHCP 工作流程如下：

1. **Discover**：客户端发送 Discover 报文（UDP 端口 67），目标地址为 255.255.255.255（广播），源地址为 0.0.0.0，覆盖整个子网。
2. **Offer**：DHCP 服务器接收 Discover 报文，回复 Offer 报文，提供所需的 IP 地址和配置信息。
3. **Request**：客户端从收到的多个 Offer 中选择一条，发送 Request 报文确认请求。
4. **Ack**：DHCP 服务器通过 Ack 报文确认客户端的请求，客户端可使用提供的信息上网。

<div align="center"> 
    <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/23219e4c-9fc0-4051-b33a-2bd95bf054ab.jpg"/>
</div><br>

## 远程登录协议

TELNET 是一种网络协议，允许用户通过命令行接口连接到远程计算机，且支持多种操作系统和设备类型。使用 TELNET，可以实现设备间的远程管理与控制。

## 电子邮件协议

电子邮件系统包括三个部分：用户代理、邮件服务器和邮件协议。邮件协议又分为发送（如 SMTP）和接收（如 POP3、IMAP）协议。

<div align="center"> 
    <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/7b3efa99-d306-4982-8cfb-e7153c33aab4.png" width="700"/>
</div><br>

### 1. SMTP

简单邮件传送协议（SMTP）用于发送电子邮件。SMTP 通常只支持 ASCII 格式的文本，而 MIME（多用途互联网邮件扩展）则允许发送二进制附加文件。MIME 为邮件主体增加了结构性，使其能够支持非 ASCII 编码。

<div align="center"> 
    <img src="https://cs-notes-1256109796.cos.ap-guangzhou.myqcloud.com/ed5522bb-3a60-481c-8654-43e7195a48fe.png" width=""/>
</div><br>

### 2. POP3

邮局协议第3版（POP3）主要用于从邮件服务器下载邮件，一旦邮件下载，服务器上的邮件将被删除。近年来，POP3 的新版本也允许用户选择保留邮件。

### 3. IMAP

互联网消息访问协议（IMAP）允许用户在服务器上管理邮件，客户端与服务器之间的邮件保持同步。用户可以随时访问邮件，除非主动删除，否则服务器上的邮件不会被删除。

## 常用端口

| 应用           | 应用层协议 | 端口号  | 传输层协议 | 备注                             |
|----------------|------------|---------|-------------|---------------------------------|
| 域名解析       | DNS        | 53      | UDP/TCP     | 响应超过 512 字节时使用 TCP                |
| 动态主机配置协议 | DHCP       | 67/68   | UDP         |                                 |
| 简单网络管理协议 | SNMP       | 161/162 | UDP         |                                 |
| 文件传送协议    | FTP        | 20/21   | TCP         | 控制连接 21，数据连接 20                 |
| 远程终端协议    | TELNET     | 23      | TCP         |                                 |
| 超文本传送协议  | HTTP       | 80      | TCP         |                                 |
| 简单邮件传送协议 | SMTP       | 25      | TCP         |                                 |
| 邮件读取协议    | POP3       | 110     | TCP         |                                 |
| 网际报文存取协议 | IMAP       | 143     | TCP         |                                 |

## Web 页面请求过程

### 1. DHCP 配置主机信息

- 如果主机没有 IP 地址和其他网络配置，首先需要通过 DHCP 获取所需信息。流程如下：

1. 主机生成一个 DHCP 请求报文，然后将该报文封装到 UDP 报文段中，设置目的端口为 67，源端口为 68。
2. 此 UDP 报文段被封装到源地址为 0.0.0.0，目的地址为 255.255.255.255 的 IP 数据报中。
3. 然后将该数据报放入以太网的 MAC 帧中，广播到同一网络中的所有设备。
4. 连接在交换机的 DHCP 服务器收到该广播帧后，逐层解封装，最终生成 DHCP ACK 报文，其中包含 IP 地址、DNS 服务器的 IP 地址、默认网关和子网掩码。
5. ACK 报文被封装成 UDP 报文段，再放入 IP 数据报中，最终包裹在 MAC 帧中返回给主机。

### 2. ARP 解析 MAC 地址

- 主机通过浏览器发送 HTTP 请求所需 IP 地址时，首先需要解析网关路由器的 MAC 地址，流程如下：

1. 主机生成一个 DNS 查询报文，并将其封装到目的地址为 DNS 服务器 IP 地址的 IP 数据报中。
2. 设置目的地址为网关路由器的 IP 地址，利用 ARP 协议查询 MAC 地址。
3. 发送一个包含 ARP 查询的以太网帧，目的地址为广播地址（FF:FF:FF:FF:FF:FF）。
4. 网关路由器收到该帧，解封装并发现其 IP 地址匹配，在 ARP 回应中将 MAC 地址发回主机。

### 3. DNS 解析域名

- 主机在获取网关路由器的 MAC 地址后，继续进行 DNS 解析：

1. 网关接收到包含 DNS 查询报文的以太网帧后，抽取出 IP 数据报，通过路由转发到 DNS 服务器。
2. DNS 服务器解析查询报文，匹配域名并找到相应的 IP 记录。
3. 发送 DNS 回答报文，经过路由返回到网关，再到主机。

### 4. HTTP 请求页面

- 获取到 HTTP 服务器的 IP 地址后，主机开始建立 TCP 连接，流程如下：

1. 主机发送一个 TCP SYN 报文，连接 HTTP 服务器（默认端口 80）。
2. 服务器响应 TCP SYN ACK 报文，完成三次握手。
3. 连接建立后，主机发送 HTTP GET 报文请求特定页面。
4. HTTP 服务器读取 GET 报文，生成 HTTP 响应，包含请求的网页内容。
5. 主机收到响应报文后，提取网页内容并进行渲染，最终显示页面。

通过上述过程，主机能够成功完成网页的请求和显示，背后涉及多个协议的协作。
```